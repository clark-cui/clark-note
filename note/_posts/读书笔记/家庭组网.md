### 家庭组网

> 最近在弄nas的时候，学着学着也就碰到了家庭组网的部分。
>
> 就做一个学习记录吧



[家庭组网名词科普6分钟](https://www.bilibili.com/video/BV1E5411s7ra)

> 猫(modem)：猫是早期设备了，早期网络是用电话线传输的，电话线里面是铜线，走的是模拟信号，需要猫把模拟信号转换成数字信号
>
> 光猫：目前光纤普及，网络用光纤传输，需要光猫把光信号转换成电信号
>
> 路由（router）：负责数据包的转发，主要是ip协议，在osi7层架构的第三层。主要作用是把要上传的东西，根据ip地址封装好传出去，把从外面过来的东西，整理好传过来，就是和因特网的连接。
>
> 交换机：负责光信号/电信号的转发，为接入交换机的任意两个节点提供独享的连接。处于osi的第二层，根据硬件的mac地址（网卡）来工作，一般有以太交换机和光纤交换机，主要作用就是连接多台设备，就是局域网的连接。
>
> ac:控制ap
>
> ap:一般就是实现无线功能。

#### 家庭宽带

家庭宽带是限制外网访问的关键，目前来说电信比较容易申请到公网ip,由于ipv4的紧张，有些公网Ip是变化的，所以需要买一个域名，配合ddns解析，实现外网访问。

宽带目前千兆是普及的，但最好上到万兆网络。



#### 装修埋线

[网线科普](https://www.bilibili.com/video/BV1eg4y1B7VV)

装修时，师傅会把网线埋进墙里，以后实现家庭局域网有线连接就直接把网线/光纤线插在插头就行。

埋线有2种选择，一种是光纤线（光线接光口），一种是网线(rj45/双绞线)（电线接电口）。

###### 千兆网络

目前普及的是千兆网络（内网），要实现千兆，需要埋千兆光纤线（配合光纤千兆网卡），或者埋千兆网线（超5类，配合以太网千兆网卡）。

###### 万兆网络

比较超前的是万兆网络。万兆双绞线（电）比万兆光纤线（光）要便宜很多，建议直接埋万兆双绞线。



#### 交换机

**原理**

交换机有很多端口，这些端口是通过MAC地址，也就是网卡的硬件地址来识别，从而达到数据交换的功能；交换机的工作原理很像理想化的交通，各个岔路口（交换机的端口）的车辆（数据）都有自己的专用车道，每辆车都有自己的目的地（MAC地址），所以主干道的交通不会堵塞（交换机的特点：无阻塞的交换数据）。

**2台设备通信**

如果只是2台主机通信，我们只需要用一根网线，连接两台设备的网口；对设备的MAC地址进行设置以后，就能实现数据交换。

**少量设备通信**

设备并不是很多的情况下，现在路由器是集成了交换机功能，可以使用路由器实现无线的通信。

![image-20200702171219119](https://gif-clark-cui.oss-cn-beijing.aliyuncs.com/blog/image-20200702171219119.png)

**方案选择**

光纤万兆网卡比以太网万兆网卡便宜很多，而且光纤万兆网卡很多均价200，但以太网万兆网卡就只看到一款800的华硕的，还有一款杂牌comfast300的卡。

万兆光纤线却比万兆双绞线贵很多。

交换机这里，目前搜索了一下，搜到的万兆交换机大都是，几个千兆电口，加2个/3个万兆光口，偶尔几款会有一个万兆电口，或者万兆光电复合口（rj45/光纤）。



所以综合来说，目前家庭所有设备实现万兆连接是不现实的，可以少数几个经常通信的设备（比如nas和剪辑设备，或者nas和家庭影院），实现万兆。

**家庭合适的方案**：装修埋线埋万兆双绞线（7类网线），交换机可以先用千兆，有钱也可以买万兆，，千兆口（一般只有rj45）配合接入千兆网卡(intel ax200,50元左右)的设备，实现千兆通信。万兆电口配合万兆以太网卡，万兆光口配合外拉明线（万兆光纤线）和万兆光纤网卡。

**个人合适的方案**：给需要快速局域网速度的设备安装千兆/万兆网卡，有线连接，电脑与电脑之间设置下ip,设置文件网络共享，电脑与nas直接用nas系统自带的共享功能。



#### 无线通信

[koolshare国内最大的无线网站 无线固件](https://koolshare.cn/portal.php)

一般有两种方式2.4g和5g，5g快，但穿墙弱，2.4g慢但穿墙好。现在路由器都是智能分配的。

**wifi6**

wifi6不仅快，还能智能分配网速，不会造成拥堵。

要实现wifi6不光是要路由器支持wifi6,用wifi的设备也要支持，目前普及的设备是2x2的天线，也就是2.4gbps，有些有8x8的，当然速度就更快。注意小米10的2x8 wifi6是假的。

首先推出wifi6的是华硕，梅林固件就是华硕固件改的。



wifi6的 5g/2.4g肯定是要更快更好的。



#### 家庭局域网分享

家庭局域网分享，一般用smb/nfs协议，设备通过协议访问共享文件的速度，一般来说有线是要比无线快的。有线万兆最快，其次千兆。无线5g最快，其次2.4g。



### 家庭无线组网

> 家里如果比较大的话，就会影响无线信号。
>
> 放置多个路由器呢，就会有多个wifi信号，在切换的时候始终不会太平滑，使用体验糟糕

#### 解决办法：

一般有ac+ap+poe供电，或者mesh两种方式解决，早期的Mesh比较昂贵，而且效果一般，所以用方案一的多，目前的话许多路由器的mesh体验都很流畅，也少了折腾。



##### 方案一：软路由+ac+ap+poe供电

![image-20200702192512254](https://gif-clark-cui.oss-cn-beijing.aliyuncs.com/blog/image-20200702192512254.png)



###### 名词解释

**ac**:ap控制器，就是用来控制ap的，一般ac控制瘦ap。

软件ac与硬件ac就是字面意思，一般买品牌的硬件ac即可。



**ap**:实现无线功能的器件。

衡量ap的指标一般都会有带机量，就是能接受多少台机器的无线wifi连接。还有无线速度，信号强弱。

胖ap跟路由器类似，可以设置选项，一般不需要ac也能自行管理，也有人把品牌路由器当作ap使用的。

瘦ap只有无线功能。

一般只用瘦ap，因为当有多个胖ap，那每个胖ap都要设置，每次加入一个新的ap，都要去重新设置一遍，反人类。使用瘦ap，用ac统一管理才是王道。



软路由实现路由功能，使用ac控制ap,用poe对ap供电减少理线烦恼。



软路由性能强，原因是选用的处理器架构本身就强，比如x86，x64架构，自然是比传统路由器的处理器架构强大，所以带来的性能就强一些。

软路由一般来说不带无线功能，你想想，如果无线部分你随随便便也自己能配了那还要传统路由器厂商做甚？至于稳定性，其实严格来说软路由稳定性应该是不如传统路由的，软路由的固件一般都是开源项目，自然不如路由器厂商原厂固件稳定，但是其实也足够稳定了。



软路由既然一般不带无线功能，那么无线部分其实就是由AP来完成，一个AP不够就用两个甚至更多的AP去扩充无线覆盖范围。

AC叫无线控制器，顾名思义就是去控制、管理你的无线网络，通过AC去统一管理各个AP，使得这些AP可以完成更多功能，比如无缝漫游之类的等等。

普通路由器带机量10-30，多了带不起来了。这个时候需要软路由了，x86架构可以带n台设备。ap其实你完全可以当他是路由器，有胖瘦两种，胖的可以进去设置和普通路由器一样，瘦的需要用ac统一管理。ap和普通路由器的最大区别是可以poe供电（就是通过poe交换机一条网线过去直接数据供电全解决）



一个up主的组网方案

[视频地址](https://www.bilibili.com/video/BV1QJ411h7Ck?from=search&seid=1081888451647412529)

![image-20200702193530713](https://gif-clark-cui.oss-cn-beijing.aliyuncs.com/blog/image-20200702193530713.png)

###### 总结

speedtest测速，跟目前品牌mesh速度差不多。但这种方案，可以照顾到所有的房间，基本上所有的房间网速都不会差，比较适合一栋房子组网。



##### 方案二：品牌路由器无线mesh

   

目前有些品牌路由器mesh，用同一品牌的，不管用多少个，他都只显示一个wifi，他会自动切换，而mesh方式的组网只需要插上网线，按下mesh按键即可，非常方便。所以只要价格不要太贵，直接用mesh路由器。把更多的时间花在装修拉线和网卡接口上。



### 总结

家庭组网，并不需要软路由那样那么强劲的性能，软路由的插件很多也已失效，目前有用的软路由功能就是可以实现ssr。但仅仅为了一个ssr就折腾软路由，还有时不时的维护成本，并不需要。

当然品牌路由器mesh，以目前最强的华硕ax1000,价格4000，他对比方案一来说，当占地很大超过700平米，他还是会比思科企业级ap要弱，无论是信号强度，还是无线漫游（就是你从一个地方到另一个地方，切换了ap，但是对你自己的感知体验，比如延迟感）。

但是家庭使用来说，已经足够了，家里也并不需要所有地方信号都多好，一些角落信号弱一点，速度慢一点也问题不大。



[2020最强家庭无线组网终极篇](https://www.bilibili.com/video/BV1KA411B7ow?from=search&seid=9569264180172516747)



### 网络连接失败排查方法

cmd输入

```
tracert 114.114.114.114         //也就是trace router ,后接一个公网ip即可，114是电信联通的dns地址，国外用8.8.8.8是谷歌的
```

![image-20200702210626538](https://gif-clark-cui.oss-cn-beijing.aliyuncs.com/blog/image-20200702210626538.png)

第一条是路由器，然后是小区网关，然后是运营商机房，从这里判断是哪里出问题了

### 局域网访问

**局域网可以脱离互联网存在**

> 局域网内的设备想相互访问，需要在同一网关下（也就是在同一网段下），就是网关ip与子网掩码相同。同一路由器下，或者路由器Mesh下，就是在同一网段的

**判断设备是否在同一网段**

判断有没有在同一网段,在一台ping一下要访问主机的ip即可。

**两台设备互相访问**：

###### 第一步

1.若在同一wifi下（注意：需要是同一网段（同一路由器或者一组mesh路由器），一些大商场里可能会有不在同一网段的情况），那他们已经连接在一个局域网里了，即使这个路由器断网了，他也是断了因特网，他们还处于一个局域网下。

2.若两台设备都没有联网，则需要一根网线把他俩连起来，组成最简单的局域网，统一网关地址和子网掩码，手动分配Ip地址即可，或者把其中一台设成网关（也就是路由），就是ip地址与网关地址相同。

###### 第二步

windows系统设置文件共享即可

**应用**

nas万兆口与主力电脑相连，享受万兆局域网，此时的网速仅仅取决去你的硬盘。

nas万兆口与万兆交换机相连，让家庭影院也能享受到万兆局域网速。

nas万兆口与路由器相连，与别的设备组成局域网，别的设备能通过共享协议访问。
### 家庭组网

> 最近在弄nas的时候，学着学着也就碰到了家庭组网的部分。
>
> 就做一个学习记录吧



[家庭组网名词科普6分钟](https://www.bilibili.com/video/BV1E5411s7ra)

> 猫(modem)：猫是早期设备了，早期网络是用电话线传输的，电话线里面是铜线，走的是模拟信号，需要猫把模拟信号转换成数字信号
>
> 光猫：目前光纤普及，网络用光纤传输，需要光猫把光信号转换成电信号
>
> 路由（router）：负责数据包的转发，主要是ip协议，在osi7层架构的第三层。主要作用是把要上传的东西，根据ip地址封装好传出去，把从外面过来的东西，整理好传过来，就是和因特网的连接。
>
> 交换机：负责光信号/电信号的转发，为接入交换机的任意两个节点提供独享的连接。处于osi的第二层，根据硬件的mac地址（网卡）来工作，一般有以太交换机和光纤交换机，主要作用就是连接多台设备，就是局域网的连接。
>
> ac:控制ap
>
> ap:一般就是实现无线功能。

#### 家庭宽带

家庭宽带是限制外网访问的关键，目前来说电信比较容易申请到公网ip,由于ipv4的紧张，有些公网Ip是变化的，所以需要买一个域名，配合ddns解析，实现外网访问。

宽带目前千兆是普及的，但最好上到万兆网络。



#### 装修埋线

[网线科普](https://www.bilibili.com/video/BV1eg4y1B7VV)

一般选择七类网线即可，不要选最高的8类线，8类最多30m，其余都是最多100m。

装修时，师傅会把网线埋进墙里，以后实现家庭局域网有线连接就直接把网线/光纤线插在插头就行。

埋线有2种选择，一种是光纤线（光线接光口），一种是网线(rj45/双绞线)（电线接电口）。

###### 千兆网络

目前普及的是千兆网络（内网），要实现千兆，需要埋千兆光纤线（配合光纤千兆网卡），或者埋千兆网线（超5类，配合以太网千兆网卡）。

###### 万兆网络

比较超前的是万兆网络。万兆双绞线（电）比万兆光纤线（光）要便宜很多，建议直接埋万兆双绞线。



#### 交换机

**原理**

交换机有很多端口，这些端口是通过MAC地址，也就是网卡的硬件地址来识别，从而达到数据交换的功能；交换机的工作原理很像理想化的交通，各个岔路口（交换机的端口）的车辆（数据）都有自己的专用车道，每辆车都有自己的目的地（MAC地址），所以主干道的交通不会堵塞（交换机的特点：无阻塞的交换数据）。

**2台设备通信**

如果只是2台主机通信，我们只需要用一根网线，连接两台设备的网口；对设备的MAC地址进行设置以后，就能实现数据交换。

**少量设备通信**

设备并不是很多的情况下，现在路由器是集成了交换机功能，可以使用路由器实现无线的通信。

![image-20200702171219119](https://gif-clark-cui.oss-cn-beijing.aliyuncs.com/blog/image-20200702171219119.png)

**方案选择**

光纤万兆网卡比以太网万兆网卡便宜很多，而且光纤万兆网卡很多均价200，但以太网万兆网卡就只看到一款800的华硕的，还有一款杂牌comfast300的卡。

万兆光纤线却比万兆双绞线贵很多。

交换机这里，目前搜索了一下，搜到的万兆交换机大都是，几个千兆电口，加2个/3个万兆光口，偶尔几款会有一个万兆电口，或者万兆光电复合口（rj45/光纤）。



所以综合来说，目前家庭所有设备实现万兆连接是不现实的，可以少数几个经常通信的设备（比如nas和剪辑设备，或者nas和家庭影院），实现万兆，有光口的设备用sfp线就可连接交换机光口，但没有光口的设备，比如个人电脑，如果交换机没有电口，则需要转接头，把sfp转rj45，价格300元左右。

**家庭合适的方案**：装修埋线埋万兆双绞线（7类网线），交换机可以先用千兆，有钱也可以买万兆，，千兆口（一般只有rj45）配合接入千兆网卡(intel ax200,50元左右)的设备，实现千兆通信。万兆电口配合万兆以太网卡万兆网线（超6类），万兆光口配合外拉明线（万兆光纤线（贵），sfp线（贵））和万兆光纤网卡或者有光口的设备。

**个人合适的方案**：给需要快速局域网速度的设备安装千兆/万兆网卡，有线连接，电脑与电脑之间设置下ip,设置文件网络共享，电脑与nas直接用nas系统自带的共享功能。



#### 无线通信

[koolshare国内最大的无线网站 无线固件](https://koolshare.cn/portal.php)

一般有两种方式2.4g和5g，5g快，但穿墙弱，2.4g慢但穿墙好。现在路由器都是智能分配的。

**wifi6**

wifi6不仅快，还能智能分配网速，不会造成拥堵。

要实现wifi6不光是要路由器支持wifi6,用wifi的设备也要支持，目前普及的设备是2x2的天线，也就是2.4gbps，有些有8x8的，当然速度就更快。注意小米10的2x8 wifi6是假的。

首先推出wifi6的是华硕，梅林固件就是华硕固件改的。



wifi6的 5g/2.4g肯定是要更快更好的。



#### 家庭局域网分享

家庭局域网分享，一般用smb/nfs协议，设备通过协议访问共享文件的速度，一般来说有线是要比无线快的。有线万兆最快，其次千兆。无线5g最快，其次2.4g。



### 家庭无线组网

> 家里如果比较大的话，就会影响无线信号。
>
> 放置多个路由器呢，就会有多个wifi信号，在切换的时候始终不会太平滑，使用体验糟糕

#### 解决办法：

一般有ac+ap+poe供电，或者mesh两种方式解决，早期的Mesh比较昂贵，而且效果一般，所以用方案一的多，目前的话许多路由器的mesh体验都很流畅，也少了折腾。



##### 方案一：软路由+ac+ap+poe供电

![image-20200702192512254](https://gif-clark-cui.oss-cn-beijing.aliyuncs.com/blog/image-20200702192512254.png)



###### 名词解释

**ac**:ap控制器，就是用来控制ap的，一般ac控制瘦ap。

软件ac与硬件ac就是字面意思，一般买品牌的硬件ac即可。



**ap**:实现无线功能的器件。

衡量ap的指标一般都会有带机量，就是能接受多少台机器的无线wifi连接。还有无线速度，信号强弱。

胖ap跟路由器类似，可以设置选项，一般不需要ac也能自行管理，也有人把品牌路由器当作ap使用的。

瘦ap只有无线功能。

一般只用瘦ap，因为当有多个胖ap，那每个胖ap都要设置，每次加入一个新的ap，都要去重新设置一遍，反人类。使用瘦ap，用ac统一管理才是王道。



软路由实现路由功能，使用ac控制ap,用poe对ap供电减少理线烦恼。



软路由性能强，原因是选用的处理器架构本身就强，比如x86，x64架构，自然是比传统路由器的处理器架构强大，所以带来的性能就强一些。

软路由一般来说不带无线功能，你想想，如果无线部分你随随便便也自己能配了那还要传统路由器厂商做甚？至于稳定性，其实严格来说软路由稳定性应该是不如传统路由的，软路由的固件一般都是开源项目，自然不如路由器厂商原厂固件稳定，但是其实也足够稳定了。



软路由既然一般不带无线功能，那么无线部分其实就是由AP来完成，一个AP不够就用两个甚至更多的AP去扩充无线覆盖范围。

AC叫无线控制器，顾名思义就是去控制、管理你的无线网络，通过AC去统一管理各个AP，使得这些AP可以完成更多功能，比如无缝漫游之类的等等。

普通路由器带机量10-30，多了带不起来了。这个时候需要软路由了，x86架构可以带n台设备。ap其实你完全可以当他是路由器，有胖瘦两种，胖的可以进去设置和普通路由器一样，瘦的需要用ac统一管理。ap和普通路由器的最大区别是可以poe供电（就是通过poe交换机一条网线过去直接数据供电全解决）



一个up主的组网方案

[视频地址](https://www.bilibili.com/video/BV1QJ411h7Ck?from=search&seid=1081888451647412529)

![image-20200702193530713](https://gif-clark-cui.oss-cn-beijing.aliyuncs.com/blog/image-20200702193530713.png)

###### 总结

speedtest测速，跟目前品牌mesh速度差不多。但这种方案，可以照顾到所有的房间，基本上所有的房间网速都不会差，比较适合一栋房子组网。



##### 方案二：品牌路由器无线mesh

   

目前有些品牌路由器mesh，用同一品牌的，不管用多少个，他都只显示一个wifi，他会自动切换，而mesh方式的组网只需要插上网线，按下mesh按键即可，非常方便。所以只要价格不要太贵，直接用mesh路由器。把更多的时间花在装修拉线和网卡接口上。



### 总结

家庭组网，并不需要软路由那样那么强劲的性能，软路由的插件很多也已失效，目前有用的软路由功能就是可以实现ssr。但仅仅为了一个ssr就折腾软路由，还有时不时的维护成本，并不需要。

当然品牌路由器mesh，以目前最强的华硕ax1000,价格4000，他对比方案一来说，当占地很大超过700平米，他还是会比思科企业级ap要弱，无论是信号强度，还是无线漫游（就是你从一个地方到另一个地方，切换了ap，但是对你自己的感知体验，比如延迟感）。

但是家庭使用来说，已经足够了，家里也并不需要所有地方信号都多好，一些角落信号弱一点，速度慢一点也问题不大。



[2020最强家庭无线组网终极篇](https://www.bilibili.com/video/BV1KA411B7ow?from=search&seid=9569264180172516747)



### 网络连接失败排查方法

cmd输入

```
tracert 114.114.114.114         //也就是trace router ,后接一个公网ip即可，114是电信联通的dns地址，国外用8.8.8.8是谷歌的
```

![image-20200702210626538](https://gif-clark-cui.oss-cn-beijing.aliyuncs.com/blog/image-20200702210626538.png)

第一条是路由器，然后是小区网关，然后是运营商机房，从这里判断是哪里出问题了

### 局域网访问

**局域网可以脱离互联网存在**

> 局域网内的设备想相互访问，需要在同一网关下（也就是在同一网段下），就是网关ip与子网掩码相同。同一路由器下，或者路由器Mesh下，就是在同一网段的

**判断设备是否在同一网段**

判断有没有在同一网段,在一台主机ping一下要访问主机的ip即可。

**两台设备互相访问**：

###### 第一步

1.若在同一wifi下（注意：需要是同一网段（同一路由器或者一组mesh路由器），连接一些大商场里的wifi时可能会有不在同一网段的情况），那他们已经连接在一个局域网里了，即使这个路由器断网了，他也是断了因特网，他们还处于一个局域网下。

2.若两台设备都没有联网，则需要一根网线把他俩连起来，组成最简单的局域网，统一网关地址和子网掩码，手动分配Ip地址即可，或者把其中一台设成网关（也就是路由），就是ip地址与网关地址相同。

###### 第二步

windows系统设置文件共享即可

**应用**

nas万兆口与主力电脑相连，享受万兆局域网，此时的网速仅仅取决去你的硬盘。

nas万兆口与万兆交换机相连，让家庭影院也能享受到万兆局域网速。

nas万兆口与路由器相连，与别的设备组成局域网，别的设备能通过共享协议无线访问。



### 组网实战

[司波图的组网](https://www.bilibili.com/video/BV1vz411b7tC?from=search&seid=6056836354045029977)

> NAT转发：
>
> NAT是Network Address Translation--网络地址转换，当在专bai用网内部的du一些主机本来已经分配zhi到了本地IP地址（即仅在本dao专用网内使用的专用地址），但现在又想和因特网上的主机通信（并不需要加密）时，可使用NAT方法。
> 这种方法需要在专用网连接到因特网的路由器上安装NAT软件。装有NAT软件的路由器叫做NAT路由器，它至少有一个有效的外部全球IP地址。这样，所有使用本地地址的主机在和外界通信时，都要在NAT路由器上将其本地地址转换成全球IP地址，才能和因特网连接。
> 另外，这种通过使用少量的公有IP 地址代表较多的私有IP 地址的方式，将有助于减缓可用的IP地址空间的枯竭。在RFC1632中有对NAT的说明。

目前大部分路由器都有NAT转发的功能，只是强弱的区别，但这个功能的实现需要有公网Ip。



补充：



2司波图使用软路由，是因为可以省下一大笔万兆交换机的钱，毕竟交换机也就是个Hub的作用。



### 宽带设置

光猫有路由模式和桥接模式，光猫上有用户/密码/Ip，通过ip可访问光猫设置页面，通过超级账号可更改上网模式，或者直接给运营商打电话。

无论有没公网ip，都要让运营商把宽带设成桥接模式，只有桥接模式，才能让下发的ip落到路由器上，才能实现更多的网络配置。

[改桥接模式视频](https://www.bilibili.com/video/BV1eT4y1J7ua?from=search&seid=15565771143662875967)

> ps：我家的路由器地址是192.168.1.1，也就是网关地址，吉比特光猫上的ip地址是192.168.100.1
>
> 然后电脑上无法访问光猫的Ip地址，所以没法查看光猫设置。
>
> 原因百度了下，可能有两个：
>
> 1.路由器Ip地址与光猫ip地址冲突，毕竟教程里光猫的Ip都是192.168.1.1，建议修改路由器的网关地址，但是我去修改的时候，路由器提示，需要手动修改别的设备的网关，这对我产生了顾虑，所以没有动他。再加上百度上说，目前主流的路由器都有自动检测功能，是不会有路由器和光猫地址冲突的情况存在。
>
> 2.光猫ip与路由器ip不在同一个网段，建议把路由器拔下来，设备直接连光猫，ping几个可能是移动的Ip地址看看。

不想麻烦，所以不设置了，以后有需要会找宽带师傅看看



没有路由器设备，可以通过光猫的路由模式，实现电脑有线或无线的上网方式。

有路由器设备，建议使用光猫的桥接模式，使用性能更好的路由器设备建立宽带连接。

当然光猫的路由模式，也可以连接路由器，加强无线性能。



**光猫使用路由模式，并完成拨号连接后。**

路由器可以使用动态IP上网的方式，从光猫的DHCP服务器获得地址上网；一般路由器默认使用该方式，若没有使用，手动调节至该模式即可。

当然，路由器也可以拨号，这没啥影响。

**光猫使用桥接模式，仅仅当做数据的透明传输。**

需要在路由器的上网设置中，选择宽带PPPoE上网方式；并在PPPoE账号、密码处依次输入运营商给你的账号和密码。



### 品牌路由器与软路由选择

##### 当下设备的有线速率

目前最顶级的路由器有线模块也是千兆口的，民用笔记本有线网卡也只是千兆口（拆笔记本的时候，只看到了一张的无线网卡，死活找不到有线网卡，应该是在主板的另外一面，所以要更换的话基本要把笔记本拆完，用卡硬工具就可以看到网卡信息，没必要拆。当然也有usb接口转千兆rj45口的线，但估计会有损耗）。

毕竟以太网的万兆网卡差不多800元，而光纤万兆网卡只要200元。

所以大部分支持万兆的设备都是光口，少数会有电口，一般有万兆口的设备比如万兆交换机，nas，4k播放器，diy台式机。

所以要组万兆局域网，要不就软路由，自己加万兆口，要不就买万兆交换机

目前很多笔记本都板载有线网卡，有些就是一块焊上去的芯片，基本都是千兆，没法换也没必要换，笔记本的无线网卡倒是一般都可以换，注意有时候不兼容的问题。台式机则都可以更换，当然也有高端主板也是板载有线网卡。

##### 当下路由器选择与连接

路由器有线部分都是千兆口的，有线连接最大就是千兆。至于说无线速率，都是几个频段累加的，比如华硕ax11000，他号称无线速率11000m，实际上是2个 4800m的5g和1个2500m的2.4g 的频段累加的，但这里就能看到，无线速率已经超过了有线，伴随着wifi6协议，理想情况没有损耗的情况下速度的确是无线快。

但是目前宽带几乎都是百兆，远远达不到千兆的速率，所以有线的稳定性反而更重要。



可预见的是，随着宽带带宽的增大，未来绝对会有万兆口的路由器，这样有线的速度就能提升。


家庭mesh，mesh路由器最好是5g连接，如果有2个5g频段，就可以其中一个只用来连接mesh，另一个连接设备。2.4g连接距离远不吃速度的家居设备，当然情况允许的话，mesh路由器也可以有线连接，走千兆接口，稳定性要更好，但速度会不会快就不一定了，有可能会更慢。



##### 未来的千兆因特网

若是桥接模式，先接交换机，再接路由器，则交换机连接设备无法上网，因为没有拨号在路由器完成，交换机那里没有拨号上网。此方案不通，但如果先连路由器，再接交换机，那么如果网速超过了千兆，那么网速就会被路由器的千兆口所限制。此时想要万兆的因特网速，就智能使用软路由加装万兆网卡，但目前网速还是百兆，等网速超过千兆了，绝对会有万兆口的路由器出来。



若改成路由模式则不存在上述问题，但此时ip并不能落在路由器上，而是在光猫进行了dhcp，路由器的NAT功能无法发挥，则无法外网访问内网



##### 补充

最近看了几个视频，对路由器的理解又有加深。软路由，cpu算力比传统路由器墙，但在路由方面比较关键的NAT能力却差很多。传统路由器因为有专用芯片，所以肯定要比diy的cpu强不少，博通芯片还是厉害。

之前考虑过的，用软路由，可以购买多个万兆网卡，从而省下一笔万兆交换机的钱，这个方案也不靠谱。

因为软路由是没有硬件支持交换机功能的，只能靠软件模拟，其能效比很差，效果也远比不上交换机。而目前传统的路由器，很多都有内置专门的交换机芯片，肯定是要比软路由强的。斯波图的软路由也只是用来NAT而已，他还是单独接了一台交换机连内网设备。

但家里设备没有很多的情况，只需要路由器就可以。

当然，当家里设备比较多以后，推荐光猫 接 路由器 接 交换机/mesh路由器，然后把家里的设备都连到交换机进行局域网通信。

今天测试了一下当前硬盘速度，固态硬盘基本都有500mb/s,而千兆网络内网通信基本能到110mb/s，万兆网络一般也有500mb/s，如果硬盘支持，甚至能到1gb/s。

注意到目前也有些2.5gbe接口，或者5gbe接口，就是比千兆强，但比万兆弱。

目前很多万兆路由器都是光口，有光口转电口的工具，但是会有传输损耗，还会有距离限制，这个要问清楚。

所以综合看，埋线可以埋7类线，但交换机和网卡路由器，只需要千兆即可。等到万兆普及了，再更换路由器网卡和交换机。

笔记本板载有线网卡，目前许多台式机主板也板载了有线网卡，一般来说只能更换无线网卡。

但是，台式机主板如果是大板，只要有多的pcie插槽，就可以插单独买的网卡，一般是pciex8/ x4，向下兼容。

或者使用usb转千兆/万兆/2.5gbe/5gbe，这种方案贵，而且会有损耗。



##### 硬盘安装

一般m2固态插入后，主板会自行给他供电，只要插好主板的24pin供电。最近的主板也对sata口进行了供电，一般x99/x370平台都有8个sata口，都是板载供电，自己只需要sata线连接即可。

但是老的主板却没有板载供电，需要单独购买sata供电线，接到板子的大4pin进行供电。当然也有大4pin分2/分3/分4/分5，建议最多分3，论坛有人分4后带不动硬盘，估计带了太多盘带不动了。大4pin一般是用来接风扇的，同理，不要分太多，带太多风扇。品牌的线一般都是1分2的。


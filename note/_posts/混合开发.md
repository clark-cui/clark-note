---
title: 手机APP
date:  2019/12/13 10:37:55
tags: 
- 科普
---

# 手机APP开发

表面上看，手机 App 都是同样的东西，就是手机上的应用程序，点击图标就能运行，但是它们的底层技术不一样。按照开发技术，App 可以分成三大类。

> - 原生应用（native application，简称 native App）
> - Web 应用（web application，简称 Web App）
> - 混合应用（hybrid application，简称 hybrid App）



### **原生 App 是专门为特定手机平台开发的应用程序** 无法在其他平台运行。

 一个手机软件如果要同时支持苹果手机和安卓手机，就需要为它们各写一个原生 App。

iOS 的原生 App 使用 Objective-C 语言或 Swift 语言，安卓使用 Java 语言或 Kotlin 语言。由于跟底层系统的语言和技术模型一致，所以原生 App 的性能和用户体验都很好。

原生 App 的优点主要是两个：（1）较好的性能和体验；（2）可以使用系统的所有硬件和软件 API，比如 GPS、摄像头、麦克风、加速计、通知推送等等，能充分发挥系统的潜力。

原生 App 的缺点主要是成本，每个手机平台都要建立一个独立的开发团队，大公司一般都有 iOS 和安卓两个开发团队。如果出现第三个平台（以前的 Windows Phone，也许将来的华为鸿蒙 OS），就要组建第三个团队，成本就更高。原生 App 使用底层操作系统的语言，都是很重的编译型语言，开发和调试成本相对较高，时间周期长。

原生 App 必须下载安装才能使用，只要升级版本，就必须重新下载安装。用户往往不愿意更新版本，厂商被迫不得不长期支持很久以前的旧版本。



### **Web App 是使用网页做的应用程序，必须在浏览器中使用。**

 比如，你在浏览器中收发邮件，就是在使用 Web App。Web App 主要使用网页技术，即 HTML、JavaScript 和 CSS。2008年，w3c 组织发布了 HTML 第5版，简称 HTML 5，该版本大大增强了网页的功能，使得网页可以当作应用程序使用，而不仅仅是展示文字和图片，这就是 Web App 的由来。

Web App 的优点是：（1）不需要下载安装，打开浏览器就能使用，而且总是使用最新版本；（2）对于开发者来说，Web App 写起来比较快，调试容易，不需要应用商店的批准就能发布。

Web App 的主要缺点有两个。首先，浏览器提供的 API（即 Web API）很有限（目前只有相机、GPS、电池等少数几个），大部分系统硬件都不能通过网页访问，也无法直接读取硬盘文件，所以 Web App 无法充分利用平台的硬件。

第二个缺点是，网页通过浏览器渲染，性能不如原生 App，不适合做性能要求较高的页面。

Web App 需要打开浏览器才能使用，这意味着，用户必须记住如何导航到它，要么直接输入网址，要么翻找书签。这使得进入 Web App，远不如原生 App 方便。这点很致命，事实表明，用户偏好原生 App。

### PWA

为了推广 Web App，谷歌公司的 Chrome 浏览器团队做了很多努力。他们认为，Web App 足以满足大多数 App 的需求，但是三大缺陷阻碍它的推广。

为了解决这些问题，Chrome 团队开发了新技术"渐进式 Web App"（Progressive Web App，缩写 PWA）。它可以把网站缓存在手机里面，供离线时使用，还能在手机首屏生成图标，直接点击进入，并且有通知推送能力，也不带有浏览器的地址栏和状态栏，跟原生 App 的使用体验非常接近。

但是，PWA 需要浏览器访问一次网站，才能在首屏生成图标，并且目前 iOS 系统的支持还不够理想，所以还只是一项探索性质的技术，迄今为止缺乏足够的成功案例。



### **混合 App （hybrid App）顾名思义就是原生 App 与 Web App 的结合。**

它的壳是原生 App，但是里面放的是网页。可以理解成，混合 App 里面隐藏了一个浏览器，用户看到的实际上是这个隐藏浏览器渲染出来的网页。

混合 App 的原生外壳称为"容器"，内部隐藏的浏览器，通常使用系统提供的网页渲染控件（即 WebView 控件），也可以自己内置一个浏览器内核。结构上，混合 App 从上到下分成三层：HTML5 网页层、网页引擎层（本质上是一个隔离的浏览器实例）、容器层。

混合 App 里面的网页不同于普通网页，可以调用底层系统所有的 API。奥秘就在于外层容器提供了 API Bridge，充当底层 API 的中介，允许内部的网页调用底层。

所谓 API Bridge 就是容器在底层接口和网页之间，建立一座桥梁，让双方通信。容器一旦接到网页的请求，就根据请求去调用底层系统的 API，然后再返回结果给网页。API Bridge 往往以 JavaScript 语言提供，方便网页调用，这时又称为 JSbridge。

不同容器的 API Bridge 是不一样的。为某个容器写的网页，不能放在另一个容器使用，也无法在浏览器使用，除非网页脚本做了兼容处理。

容器提供的 API Bridge 必须跟着平台更新。比如，iOS 发了新版本，有了新的硬件 API，容器也必须跟着推出新版的 API Bridge。如果容器没有跟上，开发者为了使用新的硬件，就只能想办法自己来写缺失的 API Bridge。

混合 App 同时具有原生 App 和 Web App的优点，又可以避免它们的一些缺点。具体来说，可以总结为三点。

（1）跨平台

Web 技术是跨平台的，开发者只写一次页面，就能支持多个平台。也就是说，混合 App 只需要一个团队就够了，开发成本较低。

（2）灵活性

混合 App 的灵活性大，很容易集成多种功能。一方面，混合 App 很容易加载外部的 H5 页面，实现 App 的插件结构；另一方面，Web 页面可以方便地调用外部的 Web 服务。

（3）开发方便

Web 页面的调试和构建，远比原生控件简单省时。页面的更新也容易，只要在服务器上发布新版本，触发容器内更新就可以了。另外，Web 开发人员也比较容易招聘，传统的前端程序员可以承担开发任务。

混合 App 的主要缺点是，由于存在网页引擎的中间层，所以性能比较欠缺，不仅不如原生 App，而且由于 WebView 不是全功能浏览器，可能比 Web App 都要慢一些。

另一个缺点是，由于页面跨平台，就无法使用只有特定平台提供的功能，导致体验不如纯的原生 App。举例来说，早期的时候，安卓有物理的后退按钮，iPhone 没有，页面设计不得不考虑这一点。

所谓小程序，可以看作是针对特定容器的 H5 开发。微信本身是一个容器，开放自己的接口（JSbridge），外部开发者使用规定的语法，编写页面，容器可以动态加载这些页面。

小程序对于微信官方的好处是，扩展了功能和应用场景，吸引外部开发者加入，繁荣了生态。对于外部开发者的好处是，有了流量入口，可以直接调用微信的各种功能（比如支付）。



------




## 移动端跨平台开发技术演进

| 比较内容 |          Flutter           |                          RN                          |             原生             |
| :------: | :------------------------: | :--------------------------------------------------: | :--------------------------: |
| 平台实现 | 通过Dart虚拟机编译成机器码 | Virtual Dom映射到原生View，通过ART虚拟机编译成机器码 |  通过ART虚拟机编译成机器码   |
| 绘制引擎 |            Skia            |                 JS V8+Skia/OpenGL ES                 |        Skia/OpenGL ES        |
| 使用语言 |            Dart            |                        React                         |         Java/Kotlin          |
| 上手难度 |            一般            |                          难                          |              /               |
| 框架程度 |             重             |                         较重                         |             一般             |
|   社区   |       丰富，谷歌力捧       |                  活跃，FaceBook支持                  |        庞大，谷歌支持        |
| 软件发布 |   支持热更新（暂未开放）   |                      支持热更新                      | 可热更新（有点麻烦且不稳定） |



第一阶段技术:原生开发

![image.png](http://api.cocoachina.com/uploads//20181213/1544669248148036.png)

当时的架构都是这种形式，在系统的framework上面不断的开发新的功能

那个年代，开源库也没有现在这么多，所以大家都是出于造轮子的过程。

但这样明显有一个痛点：

就是 Android iOS WP，网页端四分天下的格局，每个公司需要维护四个团队，这样成本很高，所以就有了一个迫切的需求，能否开发一套在多个平台上运行，这样可以大大降低开发成本。

第二阶段的技术:H5

![image.png](http://api.cocoachina.com/uploads//20181213/1544669266561319.png)

这个阶段h5兴起，甚至有一段时间大家觉得h5会替代Android原生开发，当时也出现了很多的开源框架来实现H5与底层的交互框架：PhoneGap，Cordova，Ionic，Xamarin

当然这种想法只持续了很短的一段时间，因为虽然在这种架构上有开发成本低，简单，跨平台等很多的优点，但有一个致命的缺点性能问题导致他只能在很少的应用上取得成功。（cordova官方统计，大概只有5%的使用cordove的应用能够取得成功）

这种现象持续了没有多久就有很多公司幻想能不能有一种既能跨平台，性能又高的架构解决这个问题呢？

第三阶段技术：跨平台

![image.png](http://api.cocoachina.com/uploads//20181213/1544669287654455.png)

大家看到这个架构可能一下子就想到了 RN，对，当开发者认识到 H5 是性能的遇到瓶颈问题时，果断的采取了通过原生绘制的方式来实现。这样大大的解决了性能问题。

其实采用这种技术的不止 RN，还有Weex，Luaview ，Picasso(美团) 等等目前的跨平台方案，他们的原理大同小异，只是上层采用的语言不同，中间采用的桥有差异而已，但是整个架构思想是一样的。

当人们满足于这种开发带来的便利的同时，又有了新的问题产生了，就是桥的成本太高，当涉及到频繁的跨桥调用的时候，就会出现性能问题，还有个更严重的问题就是，维护成本也很高，

当人们认为 RN 能节省一半工程师的时候，其实 RN 的维护需要更多的工程师参与进来，

RN的整体思想是一处学习到处使用，所以在Android和Ios的使用方式上还是有差异的，而且在开发插件的时候，还是需要开发android ios两套插件，能达到像H5一样，一处编写，到处运行还是有很大的差异的，所以除了android和ios团队外还需要一个团队维护RN，RN架构的维护成本要比android和ios的开发的难度高多了。所以成本比原来还高，还有很多Rn架构本身没有办法结局的问题，对于小团队来说简直就是噩梦。

第四阶段技术方案Flutter

他的整体架构是这样的

![image.png](http://api.cocoachina.com/uploads//20181213/1544669309325985.png)

它在第三阶段的基础上，增加了一个dart虚拟机，所以减少了桥的交互，所以性能方面会更加优秀，还有一点就是维护上，flutter有Google维护，所以他的插件开发将会更加规范，所以理论上很容易实现跨平台代码复用的情况

![image.png](http://api.cocoachina.com/uploads//20181213/1544669320940769.png)

综上所述：我更倾向于相信Flutter在未来会有一定的发展空间。

但是一个技术能否活下来有很多原因，技术好不一定会火，所以我并不觉得flutter一定会火，但我认为即使不是 flutter 也会有一个类似于 flutter的第四阶段的技术方式来解决目前移动开发的痛点。

**Google为甚么会选择 Flutter？**

在介绍Flutter之前一定要介绍一下Dart语言。

![image.png](http://api.cocoachina.com/uploads//20181213/1544669337661126.png)

Dart 语言我一直觉得是一个生不逢时的才子，从11年出生开始，他的目的就是干掉JS，但是一年过去了，JS各种框架产生，Dart一直在生死线上挣扎，后来没办法，Dart团队意识到取代是不可能的，先让自己活吧，我可以让你写Dart直接转换为Js，这样你可以用我啦吧，毕竟我比js更牛逼啊，但是还是没人用，后来出现了Fuchsia os，主要语言就是dart，没人用，我自己用总可以吧，Google对外宣布数据：

2016年谷歌的AdWords、AdSense和Fiber项目团队开始把Dart融入他们的前端应用开发。一项内部报告表明，Dart可以帮助他们提升25%到100%的前端开发效率。谷歌内部的Dart代码量比去年增长了3.5倍

Google从前端，到新开发的系统，到我们现在接触到的flutter都是使用dart，足以见得，Google对dart的重视。

但换句话来说，只要有一环能够成功，那么整个环路都能活起来。

Google内部有很多团队，这个任何一个都是内部团队互相竞争的一个小产物，未必是 Google 的意图，其实我不反对，但我仍然觉得Flutter 这种技术是移动发展这么多年之后的必然产物，无论 Google 是否做，都会有人来做。但是起的起不来另当别论.

Flutter的弊端

看似  Flutter 如火如荼在大肆宣扬战果，为了加快国内的普及，Flutter团队与闲鱼，头条，和腾讯开始了 推进 Flutter大生态的建设。

目前 Flutter 障碍在于：

- 性能没有比原生改善
- 无法支持热更新
- 在iOS普及上有极大的障碍







现在主流的移动开发平台是Android和iOS，之前还有过windows phone。从最开始的Hybrid混合开发技术，到RN的桥接技术，到现在新兴的Flutter技术，跨平台开发技术一直在演进。

跨平台开发第一个考虑的就是性能问题

> - RN的效率由于是将View编译成了原生View,所以效率上要比基于Cordova的HTML5高很多,但是它也有效率问题,RN的渲染机制是基于前端框架的考虑,复杂的UI渲染是需要依赖多个view叠加.比如我们渲染一个复杂的ListView,每一个小的控件,都是一个native的view,然后相互组合叠加.想想此时如果我们的list再需要滑动刷新,会有多少个对象需要渲染.所以也就有了前面所说的RN的列表方案不友好;
> - Flutter 吸收了前两者的教训之后,在渲染技术上,选择了自己实现(GDI),由于有更好的可控性,使用了新的语言Dart,避免了RN的那种通过桥接器与Javascript通讯导致效率低下的问题,所以在性能方面比RN更高一筹;有经验的开发者可以打开Android手机开发者选项里面的显示边界布局,发现Flutter的布局是一个整体.说明Flutter的渲染没用使用原生控件进行渲染

##### react-native框架原理图



![img](https://upload-images.jianshu.io/upload_images/11451874-f497b4b23ec7392f.png?imageMogr2/auto-orient/strip|imageView2/2/w/630/format/webp)

Flutter实现跨平台采用了更为彻底的方案。它既没有采用WebView也没有采用JavaScriptCore，而是自己实现了一台UI框架，然后直接系统更底层渲染系统上画UI。所以它采用的开发语言不是JS，而Dart。据称Dart语言可以编译成原生代码，直接跟原生通信。



##### Flutter框架原理图

![img](https:////upload-images.jianshu.io/upload_images/11451874-12b2515a4cb0cdb1.png?imageMogr2/auto-orient/strip|imageView2/2/w/628/format/webp)

Flutter将UI组件和渲染器从平台移动到应用程序中，这使得它们可以自定义和可扩展。Flutter唯一要求系统提供的是canvas，以便定制的UI组件可以出现在设备的屏幕上，以及访问事件（触摸，定时器等）和服务（位置、相机等）。这是Flutter可以做到跨平台而且高效的关键。另外Flutter学习了RN的UI编程方式，引入了状态机，更新UI时只更新最小改变区域。

系统的UI框架可以取代，但是系统提供的一些服务是无法取代的。Flutter在跟系统service通信方式，采用的是一种类似插件式的方式，或者有点像远程过程调用RPC方式。这种方式据说也要比RN的桥接方式高效。

## Flutter与RN异同

- Flutter性能会更好无线接近原生的体验,Dart是AOT编译的，编译成快速、可预测的本地代码
- RN采用JS语言开发，基于React，对前端工程师更友好。Dart语言受众小
- Flutter自己实现了一套UI框架，丢弃了原生的UI框架。而RN还是可以自己利用原生框架，两个各有好处。Flutter的兼容性高，RN可以利用原生已有的优秀UI
- RN的布局更像css，而Flutter的布局更像native布局，但是去掉xml通过代码直接写需要适应下
- Flutter的第三方库还很少，RN发展的早，虽然也还不完善，Flutter github还有5000多个issues要解决，还有很长的路要走。





